# 测试清单

## 超级管理员信息
- **姓名**: 王僚原
- **ID**: `79bba44c-f61d-4197-9e6b-4781a19d962b`
- **Family ID**: `79ed05a1-e0e5-4d8c-9a79-d8756c488171`
- **Role**: `admin` (家长)

## 测试步骤

### 1. 数据库设置 ✓

在 Supabase SQL Editor 中运行：

```sql
-- 运行一键修复脚本
blog-system/supabase/ONE_CLICK_FIX.sql
```

预期结果：
- ✅ 添加 review_status 等字段
- ✅ 已发布文章设为"已通过"
- ✅ RLS 策略已更新

验证：
```sql
-- 运行验证脚本
blog-system/supabase/verify-setup.sql
```

### 2. 超级管理员权限测试

使用王僚原账号登录博客后台：

#### 2.1 文章管理
- [ ] 能看到所有文章（包括其他家庭的）
- [ ] 能看到"审核状态"列
- [ ] 待审核的文章显示"审核"按钮
- [ ] 能点击"审核"按钮进入审核页面

#### 2.2 审核功能
- [ ] 能看到文章完整内容
- [ ] 能看到"通过审核"和"拒绝文章"按钮
- [ ] 点击"通过审核"后，文章状态变为"已通过"
- [ ] 点击"拒绝文章"后，文章状态变为"已拒绝"

#### 2.3 用户管理
- [ ] 能看到所有用户
- [ ] 能看到用户的家庭信息
- [ ] 超管家庭的用户显示"超管家庭"徽章
- [ ] 超管家庭的用户不能删除（按钮禁用）

### 3. 普通家庭用户测试

使用其他家庭成员账号登录：

#### 3.1 文章管理
- [ ] 只能看到自己家庭的文章
- [ ] 看不到"审核"按钮
- [ ] 能创建新文章
- [ ] 能编辑自己的文章
- [ ] 能删除自己的文章

#### 3.2 文章发布
- [ ] 创建文章后，状态为"草稿"
- [ ] 点击"发布"后，状态变为"已发布"
- [ ] 审核状态为"待审核"
- [ ] 前台看不到这篇文章（因为未审核）

### 4. 前台展示测试

访问博客前台（未登录状态）：

#### 4.1 首页
- [ ] 只显示已审核通过的文章
- [ ] 不显示待审核的文章
- [ ] 不显示已拒绝的文章
- [ ] 能看到文章标题、摘要、作者

#### 4.2 文章列表
- [ ] 只显示已审核通过的文章
- [ ] 文章数量统计正确
- [ ] 能点击文章进入详情页

#### 4.3 文章详情
- [ ] 能看到完整文章内容
- [ ] 能看到作者信息
- [ ] 能看到评论区
- [ ] 浏览量正常增加

### 5. 家庭系统集成测试

访问家庭积分系统：

#### 5.1 Dashboard
- [ ] 能看到"最新博客"卡片
- [ ] 显示最新的3篇文章
- [ ] 只显示已审核通过的文章
- [ ] 能点击文章跳转到博客

#### 5.2 博客链接
- [ ] HeaderBar 有博客图标
- [ ] Sidebar 有博客链接卡片
- [ ] 点击能跳转到博客

### 6. 审核流程完整测试

#### 6.1 创建文章（普通用户）
1. 登录普通家庭用户账号
2. 创建新文章
3. 填写标题、内容
4. 点击"发布"
5. 确认状态为"已发布 + 待审核"

#### 6.2 审核文章（超级管理员）
1. 登录王僚原账号
2. 进入文章管理
3. 看到新文章，状态为"待审核"
4. 点击"审核"按钮
5. 查看文章内容
6. 点击"通过审核"
7. 确认状态变为"已通过"

#### 6.3 前台验证
1. 退出登录
2. 访问博客首页
3. 确认能看到刚才审核通过的文章
4. 点击进入详情页
5. 确认内容正确显示

### 7. 错误处理测试

#### 7.1 权限测试
- [ ] 普通用户访问审核页面 → 显示权限不足
- [ ] 普通用户尝试删除其他家庭文章 → 失败
- [ ] 普通用户尝试编辑其他家庭文章 → 失败

#### 7.2 数据验证
- [ ] 创建文章时必填字段验证
- [ ] 文章 slug 唯一性验证
- [ ] 审核操作成功提示

## 常见问题排查

### 问题 1: 文章不显示
**检查**:
```sql
SELECT id, title, status, review_status FROM posts;
```
**解决**: 确保 status='published' 且 review_status='approved'

### 问题 2: 超管看不到审核按钮
**检查**:
```sql
SELECT id, name, role, family_id FROM profiles WHERE id = auth.uid();
```
**解决**: 确保 role='admin' 且 family_id='79ed05a1-e0e5-4d8c-9a79-d8756c488171'

### 问题 3: 家庭系统报错
**检查**: 浏览器控制台错误信息
**解决**: 确保已运行 ONE_CLICK_FIX.sql 添加字段

### 问题 4: RLS 策略错误
**检查**:
```sql
SELECT policyname FROM pg_policies WHERE tablename = 'posts';
```
**解决**: 重新运行 ONE_CLICK_FIX.sql

## 测试完成标准

- [ ] 所有测试项通过
- [ ] 没有控制台错误
- [ ] 没有数据库错误
- [ ] 用户体验流畅
- [ ] 权限控制正确

## 相关文档

- `FINAL_FIX.md` - 最终修复指南
- `REVIEW_SYSTEM.md` - 审核系统详细文档
- `ONE_CLICK_FIX.sql` - 一键修复脚本
- `verify-setup.sql` - 验证脚本
- `check-super-admin.sql` - 检查超管脚本
