# è¶…çº§ç®¡ç†å‘˜ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### è¶…çº§ç®¡ç†å‘˜å®¶åº­
**Family ID**: `79ed05a1-e0e5-4d8c-9a79-d8756c488171`

è¿™æ˜¯ç³»ç»Ÿçš„è¶…çº§ç®¡ç†å‘˜å®¶åº­ï¼Œæ‹¥æœ‰ç‰¹æ®Šæƒé™å’ŒåŠŸèƒ½ã€‚

---

## ğŸ“‹ åŠŸèƒ½æƒé™å¯¹æ¯”

### æ™®é€šå®¶åº­åŠŸèƒ½
æ‰€æœ‰å®¶åº­ï¼ˆåŒ…æ‹¬è¶…çº§ç®¡ç†å‘˜ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ï¼š

| åŠŸèƒ½ | è¯´æ˜ | ä½ç½® |
|------|------|------|
| **æ³¨é”€è´¦æˆ·** | åˆ é™¤å®¶åº­æ‰€æœ‰æ•°æ®ï¼ˆéœ€äºŒæ¬¡ç¡®è®¤ï¼‰ | ç³»ç»Ÿè®¾ç½® |
| **è¯­è¨€åˆ‡æ¢** | ä¸­æ–‡/è‹±æ–‡åˆ‡æ¢ | ç³»ç»Ÿè®¾ç½® |
| **ä¸»é¢˜åˆ‡æ¢** | æ—¥é—´/å¤œé—´æ¨¡å¼ | ç³»ç»Ÿè®¾ç½® |
| **å¯¼å‡ºæ•°æ®** | å¯¼å‡ºå®¶åº­æ•°æ®ä¸º JSON | ç³»ç»Ÿè®¾ç½® |
| **æ¸…é™¤ç¼“å­˜** | æ¸…ç†æœ¬åœ°ç¼“å­˜ | ç³»ç»Ÿè®¾ç½® |
| **æŸ¥çœ‹ç‰ˆæœ¬** | æ˜¾ç¤ºåº”ç”¨ç‰ˆæœ¬å· | ç³»ç»Ÿè®¾ç½® |
| **æŸ¥çœ‹å®¶åº­ID** | æ˜¾ç¤ºå¹¶å¤åˆ¶å®¶åº­ ID | ç³»ç»Ÿè®¾ç½® |

### è¶…çº§ç®¡ç†å‘˜ä¸“å±åŠŸèƒ½
ä»… `79ed05a1-e0e5-4d8c-9a79-d8756c488171` å®¶åº­å¯ç”¨ï¼š

| åŠŸèƒ½ | è¯´æ˜ | ä½ç½® |
|------|------|------|
| **æŸ¥çœ‹æ‰€æœ‰åé¦ˆ** | æŸ¥çœ‹æ‰€æœ‰å®¶åº­æäº¤çš„åé¦ˆ | ç³»ç»Ÿè®¾ç½® â†’ ç”¨æˆ·åé¦ˆ |
| **å›å¤åé¦ˆ** | å›å¤ç”¨æˆ·åé¦ˆ | ç³»ç»Ÿè®¾ç½® â†’ ç”¨æˆ·åé¦ˆ |
| **ç®¡ç†åé¦ˆçŠ¶æ€** | æ ‡è®°ä¸ºå·²å›å¤/å·²å…³é—­ | ç³»ç»Ÿè®¾ç½® â†’ ç”¨æˆ·åé¦ˆ |
| **æŸ¥çœ‹åé¦ˆç»Ÿè®¡** | æŸ¥çœ‹åé¦ˆæ•°é‡ã€ä¼˜å…ˆçº§ç­‰ç»Ÿè®¡ | ç³»ç»Ÿè®¾ç½® â†’ ç”¨æˆ·åé¦ˆ |

---

## ğŸ” æƒé™éªŒè¯é€»è¾‘

### å‰ç«¯æƒé™æ£€æŸ¥
```typescript
const SUPER_ADMIN_FAMILY_ID = '79ed05a1-e0e5-4d8c-9a79-d8756c488171';

// æ£€æŸ¥æ˜¯å¦æ˜¯è¶…çº§ç®¡ç†å‘˜
const isSuperAdmin = currentSyncId === SUPER_ADMIN_FAMILY_ID;

// æ ¹æ®æƒé™æ˜¾ç¤ºä¸åŒåŠŸèƒ½
{isSuperAdmin && (
  <FeedbackManagement />  // ä»…è¶…çº§ç®¡ç†å‘˜å¯è§
)}
```

### æ•°æ®åº“æƒé™ç­–ç•¥
```sql
-- è¶…çº§ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
CREATE POLICY "Super admin can view all feedback"
  ON feedback
  FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE id = auth.uid()
      AND family_id = '79ed05a1-e0e5-4d8c-9a79-d8756c488171'
    )
  );

-- è¶…çº§ç®¡ç†å‘˜å¯ä»¥æ›´æ–°æ‰€æœ‰åé¦ˆ
CREATE POLICY "Super admin can update all feedback"
  ON feedback
  FOR UPDATE
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE id = auth.uid()
      AND family_id = '79ed05a1-e0e5-4d8c-9a79-d8756c488171'
    )
  );
```

---

## ğŸ“Š ç³»ç»Ÿè®¾ç½®é¡µé¢ç»“æ„

### æ ‡ç­¾é¡µå¸ƒå±€
```
ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ è´¦æˆ·ä¸å®‰å…¨
â”‚   â””â”€â”€ æ³¨é”€è´¦æˆ· (æ‰€æœ‰å®¶åº­)
â”œâ”€â”€ å¤–è§‚è®¾ç½®
â”‚   â”œâ”€â”€ è¯­è¨€åˆ‡æ¢ (æ‰€æœ‰å®¶åº­)
â”‚   â””â”€â”€ ä¸»é¢˜åˆ‡æ¢ (æ‰€æœ‰å®¶åº­)
â”œâ”€â”€ æ•°æ®ç®¡ç†
â”‚   â”œâ”€â”€ å¯¼å‡ºæ•°æ® (æ‰€æœ‰å®¶åº­)
â”‚   â””â”€â”€ æ¸…é™¤ç¼“å­˜ (æ‰€æœ‰å®¶åº­)
â”œâ”€â”€ ç³»ç»Ÿä¿¡æ¯
â”‚   â”œâ”€â”€ å®¶åº­ ID (æ‰€æœ‰å®¶åº­)
â”‚   â””â”€â”€ åº”ç”¨ç‰ˆæœ¬ (æ‰€æœ‰å®¶åº­)
â””â”€â”€ ç”¨æˆ·åé¦ˆ (ä»…è¶…çº§ç®¡ç†å‘˜)
    â”œâ”€â”€ åé¦ˆåˆ—è¡¨
    â”œâ”€â”€ åé¦ˆè¯¦æƒ…
    â”œâ”€â”€ å›å¤åé¦ˆ
    â””â”€â”€ åé¦ˆç»Ÿè®¡
```

---

## ğŸ’¬ ç”¨æˆ·åé¦ˆç³»ç»Ÿ

### æ™®é€šå®¶åº­
**åŠŸèƒ½**ï¼šæäº¤åé¦ˆç»™è¶…çº§ç®¡ç†å‘˜

**å¯ä»¥åšçš„äº‹**ï¼š
- âœ… æäº¤æ–°åé¦ˆ
- âœ… æŸ¥çœ‹è‡ªå·±çš„åé¦ˆ
- âœ… ç¼–è¾‘å¾…å¤„ç†çš„åé¦ˆ
- âœ… åˆ é™¤å¾…å¤„ç†çš„åé¦ˆ
- âœ… æŸ¥çœ‹ç®¡ç†å‘˜å›å¤

**åé¦ˆåˆ†ç±»**ï¼š
- ä¸€èˆ¬åé¦ˆ (general)
- é”™è¯¯æŠ¥å‘Š (bug)
- åŠŸèƒ½å»ºè®® (feature)
- é—®é¢˜å’¨è¯¢ (question)
- éšç§ç›¸å…³ (privacy)
- å…¶ä»– (other)

### è¶…çº§ç®¡ç†å‘˜å®¶åº­
**åŠŸèƒ½**ï¼šç®¡ç†æ‰€æœ‰ç”¨æˆ·åé¦ˆ

**å¯ä»¥åšçš„äº‹**ï¼š
- âœ… æŸ¥çœ‹æ‰€æœ‰å®¶åº­çš„åé¦ˆ
- âœ… å›å¤åé¦ˆ
- âœ… æ›´æ”¹åé¦ˆçŠ¶æ€ï¼ˆå¾…å¤„ç†/å·²å›å¤/å·²å…³é—­ï¼‰
- âœ… è®¾ç½®åé¦ˆä¼˜å…ˆçº§
- âœ… åˆ é™¤ä»»ä½•åé¦ˆ
- âœ… æŸ¥çœ‹åé¦ˆç»Ÿè®¡

**åé¦ˆçŠ¶æ€**ï¼š
- å¾…å¤„ç† (pending) - æ–°æäº¤çš„åé¦ˆ
- å·²å›å¤ (replied) - ç®¡ç†å‘˜å·²å›å¤
- å·²å…³é—­ (closed) - é—®é¢˜å·²è§£å†³

**ä¼˜å…ˆçº§**ï¼š
- ä½ (low)
- æ™®é€š (normal)
- é«˜ (high)
- ç´§æ€¥ (urgent)

---

## ğŸ¨ UI è®¾è®¡

### æ™®é€šå®¶åº­ - æäº¤åé¦ˆç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¬ æäº¤åé¦ˆ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åé¦ˆä¸»é¢˜ï¼š                          â”‚
â”‚  [è¾“å…¥æ¡†]                            â”‚
â”‚                                      â”‚
â”‚  åé¦ˆåˆ†ç±»ï¼š                          â”‚
â”‚  [ä¸€èˆ¬] [é”™è¯¯] [å»ºè®®] [é—®é¢˜] [å…¶ä»–]  â”‚
â”‚                                      â”‚
â”‚  è¯¦ç»†æè¿°ï¼š                          â”‚
â”‚  [æ–‡æœ¬åŸŸ]                            â”‚
â”‚                                      â”‚
â”‚  [å–æ¶ˆ]  [æäº¤åé¦ˆ]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¶…çº§ç®¡ç†å‘˜ - åé¦ˆç®¡ç†ç•Œé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š åé¦ˆç»Ÿè®¡                         â”‚
â”‚  æ€»æ•°: 25  å¾…å¤„ç†: 8  å·²å›å¤: 15    â”‚
â”‚  é«˜ä¼˜å…ˆçº§: 3                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ åé¦ˆåˆ—è¡¨                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ”´ [ç´§æ€¥] ç™»å½•é—®é¢˜             â”‚  â”‚
â”‚  â”‚ æ¥è‡ª: å¼ ä¸‰å®¶åº­                 â”‚  â”‚
â”‚  â”‚ æ—¶é—´: 2024-01-15              â”‚  â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å›å¤]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸŸ¡ [æ™®é€š] åŠŸèƒ½å»ºè®®             â”‚  â”‚
â”‚  â”‚ æ¥è‡ª: æå››å®¶åº­                 â”‚  â”‚
â”‚  â”‚ æ—¶é—´: 2024-01-14              â”‚  â”‚
â”‚  â”‚ [æŸ¥çœ‹è¯¦æƒ…] [å›å¤]             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. å¸¸é‡å®šä¹‰
```typescript
// constants.ts
export const SUPER_ADMIN_FAMILY_ID = '79ed05a1-e0e5-4d8c-9a79-d8756c488171';

// æ£€æŸ¥æ˜¯å¦æ˜¯è¶…çº§ç®¡ç†å‘˜
export const isSuperAdmin = (familyId?: string) => {
  return familyId === SUPER_ADMIN_FAMILY_ID;
};
```

### 2. SystemSettings ç»„ä»¶æ›´æ–°
```typescript
interface SystemSettingsProps {
  currentSyncId?: string;
  language: Language;
  // ... å…¶ä»– props
}

export function SystemSettings({ currentSyncId, ...props }: SystemSettingsProps) {
  const isSuperAdmin = currentSyncId === SUPER_ADMIN_FAMILY_ID;
  
  return (
    <div>
      {/* æ‰€æœ‰å®¶åº­éƒ½å¯è§çš„åŠŸèƒ½ */}
      <AccountSecurity />
      <AppearanceSettings />
      <DataManagement />
      <SystemInfo />
      
      {/* ä»…è¶…çº§ç®¡ç†å‘˜å¯è§ */}
      {isSuperAdmin && (
        <FeedbackManagement />
      )}
    </div>
  );
}
```

### 3. æ•°æ®åº“æŸ¥è¯¢
```typescript
// æ™®é€šå®¶åº­ï¼šæŸ¥çœ‹è‡ªå·±çš„åé¦ˆ
const { data: myFeedback } = await supabase
  .from('feedback')
  .select('*')
  .eq('family_id', currentSyncId);

// è¶…çº§ç®¡ç†å‘˜ï¼šæŸ¥çœ‹æ‰€æœ‰åé¦ˆ
const { data: allFeedback } = await supabase
  .from('feedback')
  .select(`
    *,
    profile:profiles(name),
    family:families(name)
  `)
  .order('created_at', { ascending: false });
```

---

## ğŸ“ æ•°æ®åº“è¡¨ç»“æ„

### feedback è¡¨
```sql
CREATE TABLE feedback (
  id UUID PRIMARY KEY,
  family_id UUID NOT NULL,           -- æäº¤åé¦ˆçš„å®¶åº­
  profile_id UUID NOT NULL,          -- æäº¤åé¦ˆçš„ç”¨æˆ·
  subject TEXT NOT NULL,             -- åé¦ˆä¸»é¢˜
  message TEXT NOT NULL,             -- åé¦ˆå†…å®¹
  category TEXT NOT NULL,            -- åˆ†ç±»
  status TEXT NOT NULL,              -- çŠ¶æ€
  priority TEXT DEFAULT 'normal',    -- ä¼˜å…ˆçº§
  admin_reply TEXT,                  -- ç®¡ç†å‘˜å›å¤
  admin_replied_at TIMESTAMPTZ,      -- å›å¤æ—¶é—´
  admin_replied_by UUID,             -- å›å¤äºº
  created_at TIMESTAMPTZ,            -- åˆ›å»ºæ—¶é—´
  updated_at TIMESTAMPTZ             -- æ›´æ–°æ—¶é—´
);
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
# åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
\i family-points-bank/supabase/migrations/010_add_feedback_system.sql
\i family-points-bank/supabase/migrations/011_add_delete_family_function.sql
```

### 2. æ›´æ–°å‰ç«¯ç»„ä»¶
- âœ… SystemSettings.tsx - æ·»åŠ æƒé™æ£€æŸ¥
- âœ… SettingsSection.tsx - æ·»åŠ ç³»ç»Ÿæ ‡ç­¾é¡µ
- âœ… FeedbackManagement.tsx - åˆ›å»ºåé¦ˆç®¡ç†ç»„ä»¶ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
- âœ… FeedbackForm.tsx - åˆ›å»ºåé¦ˆæäº¤è¡¨å•ï¼ˆæ™®é€šç”¨æˆ·ï¼‰

### 3. æ·»åŠ ç¿»è¯‘
```typescript
// i18n/translations.ts
settings: {
  system: 'ç³»ç»Ÿè®¾ç½®',
  feedback: 'ç”¨æˆ·åé¦ˆ',
  submitFeedback: 'æäº¤åé¦ˆ',
  manageFeedback: 'ç®¡ç†åé¦ˆ',
  // ...
}
```

---

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. å‰ç«¯æƒé™æ£€æŸ¥
```typescript
// âŒ é”™è¯¯ï¼šä»…å‰ç«¯æ£€æŸ¥
if (isSuperAdmin) {
  // æ˜¾ç¤ºæ•æ„ŸåŠŸèƒ½
}

// âœ… æ­£ç¡®ï¼šå‰ç«¯ + åç«¯åŒé‡éªŒè¯
if (isSuperAdmin) {
  // æ˜¾ç¤ºåŠŸèƒ½
  // ä½†åç«¯ RLS ç­–ç•¥ä¼šå†æ¬¡éªŒè¯
}
```

### 2. åç«¯ RLS ç­–ç•¥
```sql
-- å¿…é¡»åœ¨æ•°æ®åº“å±‚é¢éªŒè¯æƒé™
CREATE POLICY "Super admin only"
  ON feedback
  FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM profiles
      WHERE id = auth.uid()
      AND family_id = '79ed05a1-e0e5-4d8c-9a79-d8756c488171'
    )
  );
```

### 3. API è°ƒç”¨éªŒè¯
```typescript
// åœ¨è°ƒç”¨æ•æ„Ÿ API å‰éªŒè¯
const { data, error } = await supabase.rpc('admin_function', {
  // å‚æ•°
});

if (error) {
  // å¤„ç†æƒé™é”™è¯¯
  console.error('Permission denied:', error);
}
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å»ºè®®è®°å½•çš„æ“ä½œ
- âœ… è¶…çº§ç®¡ç†å‘˜æŸ¥çœ‹åé¦ˆ
- âœ… è¶…çº§ç®¡ç†å‘˜å›å¤åé¦ˆ
- âœ… è¶…çº§ç®¡ç†å‘˜æ›´æ”¹åé¦ˆçŠ¶æ€
- âœ… è¶…çº§ç®¡ç†å‘˜åˆ é™¤åé¦ˆ
- âœ… ç”¨æˆ·æäº¤åé¦ˆ
- âœ… ç”¨æˆ·åˆ é™¤è‡ªå·±çš„åé¦ˆ

### æ—¥å¿—æ ¼å¼
```json
{
  "action": "admin_reply_feedback",
  "admin_family_id": "79ed05a1-e0e5-4d8c-9a79-d8756c488171",
  "admin_profile_id": "uuid",
  "feedback_id": "uuid",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## âœ… åŠŸèƒ½æ£€æŸ¥æ¸…å•

### æ‰€æœ‰å®¶åº­
- [ ] æ³¨é”€è´¦æˆ·ï¼ˆäºŒæ¬¡ç¡®è®¤ï¼‰
- [ ] è¯­è¨€åˆ‡æ¢
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] å¯¼å‡ºæ•°æ®
- [ ] æ¸…é™¤ç¼“å­˜
- [ ] æŸ¥çœ‹å®¶åº­ ID
- [ ] æŸ¥çœ‹åº”ç”¨ç‰ˆæœ¬
- [ ] æäº¤åé¦ˆ
- [ ] æŸ¥çœ‹è‡ªå·±çš„åé¦ˆ

### è¶…çº§ç®¡ç†å‘˜ä¸“å±
- [ ] æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
- [ ] å›å¤åé¦ˆ
- [ ] æ›´æ”¹åé¦ˆçŠ¶æ€
- [ ] è®¾ç½®åé¦ˆä¼˜å…ˆçº§
- [ ] åˆ é™¤ä»»ä½•åé¦ˆ
- [ ] æŸ¥çœ‹åé¦ˆç»Ÿè®¡

---

## ğŸ‰ æ€»ç»“

ç³»ç»Ÿè®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **æƒé™åˆ†ç¦»** - æ™®é€šåŠŸèƒ½æ‰€æœ‰å®¶åº­å¯ç”¨ï¼Œç®¡ç†åŠŸèƒ½ä»…è¶…çº§ç®¡ç†å‘˜å¯ç”¨
2. **åŒé‡éªŒè¯** - å‰ç«¯ UI æ§åˆ¶ + åç«¯ RLS ç­–ç•¥
3. **ç»Ÿä¸€å…¥å£** - æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨"ç³»ç»Ÿè®¾ç½®"æ ‡ç­¾é¡µ
4. **æ¸…æ™°æ ‡è¯†** - è¶…çº§ç®¡ç†å‘˜åŠŸèƒ½æœ‰æ˜æ˜¾çš„è§†è§‰åŒºåˆ†
5. **å®‰å…¨ç¬¬ä¸€** - æ•æ„Ÿæ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤

**è¶…çº§ç®¡ç†å‘˜å®¶åº­ ID**: `79ed05a1-e0e5-4d8c-9a79-d8756c488171`
