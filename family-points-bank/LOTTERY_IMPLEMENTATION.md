# ðŸŽ° æŠ½å¥–ç³»ç»Ÿå®žæ–½æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“å±‚ (Supabase)
- âœ… åˆ›å»º `lottery_records` è¡¨ - å­˜å‚¨æŠ½å¥–è®°å½•
- âœ… åˆ›å»º `daily_lottery_limits` è¡¨ - ç®¡ç†æ¯æ—¥å…‘æ¢é™åˆ¶
- âœ… å®žçŽ° 6 ä¸ªæ•°æ®åº“å‡½æ•°:
  - `check_daily_lottery_limit()` - æ£€æŸ¥æ¯æ—¥å…‘æ¢æ¬¡æ•°
  - `get_lottery_points()` - æŠ½å¥–ç®—æ³• (åŠ æƒéšæœº)
  - `lottery_from_badge()` - å¾½ç« æŠ½å¥–
  - `lottery_from_exchange()` - ç§¯åˆ†å…‘æ¢æŠ½å¥–
  - `get_lottery_stats()` - èŽ·å–æŠ½å¥–ç»Ÿè®¡
  - `cleanup_old_daily_limits()` - æ¸…ç†è¿‡æœŸè®°å½•
- âœ… é…ç½® RLS å®‰å…¨ç­–ç•¥
- âœ… åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

**æ–‡ä»¶**: `supabase/migrations/006_lottery_system.sql`

---

### 2. ç±»åž‹å®šä¹‰
- âœ… æ›´æ–° `Transaction` ç±»åž‹,æ·»åŠ  `'lottery'` å’Œ `'exchange'`
- âœ… æ–°å¢ž `LotteryRecord` æŽ¥å£
- âœ… æ–°å¢ž `LotteryStats` æŽ¥å£

**æ–‡ä»¶**: `types.ts`

---

### 3. å‰ç«¯ç»„ä»¶

#### `LotteryWheel.tsx` (æ–°å»º)
- âœ… 8æ‰‡åŒºè½¬ç›˜è®¾è®¡
- âœ… 3ç§’æ—‹è½¬åŠ¨ç”» (åŠ é€Ÿâ†’åŒ€é€Ÿâ†’å‡é€Ÿ)
- âœ… çƒŸèŠ±ç‰¹æ•ˆ
- âœ… ç»“æžœå±•ç¤º
- âœ… å“åº”å¼è®¾è®¡

#### `LotteryRulesModal.tsx` (æ–°å»º)
- âœ… æŠ½å¥–æ–¹å¼è¯´æ˜Ž (å¾½ç« /å…‘æ¢)
- âœ… å¥–åŠ±åˆ†å¸ƒå±•ç¤º (å››æ¡£æ¦‚çŽ‡)
- âœ… ä½¿ç”¨æŠ€å·§æç¤º
- âœ… æ³¨æ„äº‹é¡¹è­¦å‘Š
- âœ… ç²¾ç¾Žçš„å¡ç‰‡å¼å¸ƒå±€

#### `AchievementCenter.tsx` (é‡æž„)
- âœ… ç§»é™¤"è¶‹åŠ¿é¢„æµ‹"åŠŸèƒ½
- âœ… æ·»åŠ æŠ½å¥–ç»Ÿè®¡å¡ç‰‡ (4ä¸ªæŒ‡æ ‡)
- âœ… é›†æˆ"å…‘æ¢æŠ½å¥–"æŒ‰é’®
- âœ… æ·»åŠ "è§„åˆ™è¯´æ˜Ž"æŒ‰é’® (å³ä¸Šè§’)
- âœ… ç®¡ç†è½¬ç›˜å¼¹çª—çŠ¶æ€
- âœ… ç®¡ç†è§„åˆ™å¼¹çª—çŠ¶æ€
- âœ… å¤„ç†æŠ½å¥–å®Œæˆé€»è¾‘

#### `BadgeSection.tsx` (å¢žå¼º)
- âœ… æ·»åŠ  `onBadgeClaimed` å›žè°ƒ
- âœ… é¢†å–å¾½ç« åŽè§¦å‘æŠ½å¥–

---

### 4. æ–‡æ¡£
- âœ… å®Œæ•´çš„ç³»ç»Ÿè¯´æ˜Žæ–‡æ¡£ (`lottery.md`)
  - ç³»ç»Ÿæ¦‚è¿°
  - åŠŸèƒ½ç‰¹æ€§
  - æ•°æ®åº“è®¾è®¡
  - æŠ½å¥–ç®—æ³•è¯¦è§£
  - å‰ç«¯ç»„ä»¶è¯´æ˜Ž
  - ä½¿ç”¨æµç¨‹
  - éƒ¨ç½²æŒ‡å—
  - å¸¸è§é—®é¢˜ (FAQ)
  - æ•°æ®ç»Ÿè®¡ç¤ºä¾‹
  - å®‰å…¨æ€§è¯´æ˜Ž

---

## ðŸŽ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. å¾½ç« å¥–åŠ±æŠ½å¥–
- èŽ·å¾—å¾½ç«  â†’ è‡ªåŠ¨å¼¹å‡ºè½¬ç›˜ â†’ æŠ½å– 1-50 å…ƒæ°”å€¼
- æ¯ä¸ªå¾½ç« ä»…å¯æŠ½å¥–ä¸€æ¬¡

### 2. ç§¯åˆ†å…‘æ¢æŠ½å¥–
- æ¶ˆè€— 10 ç§¯åˆ† â†’ èŽ·å¾—ä¸€æ¬¡æŠ½å¥–æœºä¼š â†’ æŠ½å– 1-50 å…ƒæ°”å€¼
- æ¯å¤©æœ€å¤šå…‘æ¢ 3 æ¬¡
- æ¯æ—¥ 0 ç‚¹è‡ªåŠ¨é‡ç½®

### 3. æŠ½å¥–ç®—æ³• (åŠ æƒéšæœº)
```
40% æ¦‚çŽ‡ â†’ 1-10 åˆ†   (ç»¿è‰²)
30% æ¦‚çŽ‡ â†’ 11-20 åˆ†  (è“è‰²)
20% æ¦‚çŽ‡ â†’ 21-35 åˆ†  (ç´«è‰²)
10% æ¦‚çŽ‡ â†’ 36-50 åˆ†  (é‡‘è‰²å¤§å¥–)

æœŸæœ›å€¼: 16.75 åˆ†
ROI: 67.5% (é¼“åŠ±å…‘æ¢)
```

---

## ðŸ“¦ æ–‡ä»¶æ¸…å•

```
family-points-bank/
â”œâ”€â”€ supabase/migrations/
â”‚   â””â”€â”€ 006_lottery_system.sql          # æ•°æ®åº“è¿ç§»æ–‡ä»¶ â­
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LotteryWheel.tsx                # è½¬ç›˜ç»„ä»¶ â­
â”‚   â”œâ”€â”€ LotteryRulesModal.tsx           # è§„åˆ™è¯´æ˜Žå¼¹çª— â­
â”‚   â”œâ”€â”€ AchievementCenter.tsx           # æˆå°±ä¸­å¿ƒ (é‡æž„) â­
â”‚   â””â”€â”€ BadgeSection.tsx                # å¾½ç« åŒºåŸŸ (å¢žå¼º) â­
â”œâ”€â”€ types.ts                            # ç±»åž‹å®šä¹‰ (æ›´æ–°) â­
â”œâ”€â”€ lottery.md                          # å®Œæ•´è¯´æ˜Žæ–‡æ¡£ â­
â”œâ”€â”€ LOTTERY_IMPLEMENTATION.md           # å®žæ–½æ€»ç»“ â­
â””â”€â”€ LOTTERY_QUICKSTART.md               # å¿«é€Ÿå¼€å§‹æŒ‡å— â­
```

---

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ‰§è¡Œæ•°æ®åº“è¿ç§»
```bash
# æ–¹å¼ 1: åœ¨ Supabase Dashboard ä¸­æ‰§è¡Œ
# æ‰“å¼€ SQL Editor,ç²˜è´´ 006_lottery_system.sql å†…å®¹å¹¶æ‰§è¡Œ

# æ–¹å¼ 2: ä½¿ç”¨ Supabase CLI
supabase db push
```

### 2. éªŒè¯æ•°æ®åº“
```sql
-- æ£€æŸ¥è¡¨
SELECT table_name FROM information_schema.tables 
WHERE table_name IN ('lottery_records', 'daily_lottery_limits');

-- æ£€æŸ¥å‡½æ•°
SELECT routine_name FROM information_schema.routines 
WHERE routine_name LIKE '%lottery%';
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
yarn dev
```

### 4. æµ‹è¯•åŠŸèƒ½
1. è®¿é—®æˆå°±ä¸­å¿ƒ
2. ç‚¹å‡»"å…‘æ¢æŠ½å¥–"æŒ‰é’®
3. è§‚å¯Ÿè½¬ç›˜åŠ¨ç”»
4. æŸ¥çœ‹ç§¯åˆ†å˜åŒ–

---

## ðŸŽ¨ UI é¢„è§ˆ

### æˆå°±ä¸­å¿ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ† æˆå°±ä¸­å¿ƒ                             â”‚
â”‚  æˆ‘çš„æˆå°±ä¸ŽæŠ½å¥–                          â”‚
â”‚  æŸ¥çœ‹ä½ çš„å¾½ç« æˆå°±,å‚ä¸Žå¹¸è¿æŠ½å¥–èµ¢å–å…ƒæ°”å€¼  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ€»æ¬¡ â”‚ â”‚ ç´¯è®¡ â”‚ â”‚ ä»Šæ—¥ â”‚ â”‚ å½“å‰ â”‚  â”‚
â”‚  â”‚  15  â”‚ â”‚ 245  â”‚ â”‚  1   â”‚ â”‚ 120  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  [ðŸŽ å…‘æ¢æŠ½å¥– (10ç§¯åˆ†)]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è½¬ç›˜
```
        â–¼ æŒ‡é’ˆ
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   /  36-50   \
  /   (é‡‘è‰²)   \
 â”‚              â”‚
 â”‚   1-10       â”‚ 21-35
 â”‚  (ç»¿è‰²)      â”‚ (ç´«è‰²)
 â”‚              â”‚
  \   11-20    /
   \  (è“è‰²)  /
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    [ðŸŽ å¼€å§‹æŠ½å¥–]
```

---

## ðŸ“Š æ•°æ®æµ

### å¾½ç« æŠ½å¥–æµç¨‹
```
ç”¨æˆ·é¢†å–å¾½ç« 
    â†“
å‰ç«¯: onBadgeClaimed(badgeId, badgeTitle)
    â†“
æ˜¾ç¤ºè½¬ç›˜ (source='badge')
    â†“
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æŠ½å¥–"
    â†“
è½¬ç›˜æ—‹è½¬åŠ¨ç”» (3ç§’)
    â†“
è°ƒç”¨: lottery_from_badge(profileId, badgeId)
    â†“
åŽç«¯: æ£€æŸ¥å¾½ç« æ˜¯å¦å·²ç”¨ â†’ æ‰§è¡ŒæŠ½å¥– â†’ è®°å½•ç»“æžœ â†’ æ·»åŠ ç§¯åˆ†
    â†“
è¿”å›ž: èŽ·å¾—çš„ç§¯åˆ†æ•°
    â†“
å‰ç«¯: æ˜¾ç¤ºç»“æžœ + åˆ·æ–°ç»Ÿè®¡
```

### ç§¯åˆ†å…‘æ¢æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»"å…‘æ¢æŠ½å¥–"
    â†“
å‰ç«¯: éªŒè¯ç§¯åˆ† >= 10 && ä»Šæ—¥æ¬¡æ•° < 3
    â†“
æ˜¾ç¤ºè½¬ç›˜ (source='exchange')
    â†“
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æŠ½å¥–"
    â†“
è½¬ç›˜æ—‹è½¬åŠ¨ç”» (3ç§’)
    â†“
è°ƒç”¨: lottery_from_exchange(profileId)
    â†“
åŽç«¯: æ‰£é™¤10ç§¯åˆ† â†’ æ‰§è¡ŒæŠ½å¥– â†’ è®°å½•ç»“æžœ â†’ æ·»åŠ ç§¯åˆ† â†’ æ›´æ–°æ¬¡æ•°
    â†“
è¿”å›ž: èŽ·å¾—çš„ç§¯åˆ†æ•°
    â†“
å‰ç«¯: æ˜¾ç¤ºç»“æžœ + åˆ·æ–°ç»Ÿè®¡
```

---

## ðŸ” å®‰å…¨æ€§

- âœ… **RLS ç­–ç•¥**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- âœ… **åŽç«¯éªŒè¯**: ç§¯åˆ†ã€æ¬¡æ•°ã€å¾½ç« çŠ¶æ€å…¨éƒ¨åŽç«¯éªŒè¯
- âœ… **é˜²é‡å¤**: å¾½ç« æŠ½å¥–æ£€æŸ¥æ˜¯å¦å·²ä½¿ç”¨
- âœ… **æ¯æ—¥é™åˆ¶**: æ•°æ®åº“çº¦æŸ `exchange_count <= 3`
- âœ… **ç»“æžœç”Ÿæˆ**: åŽç«¯å†³å®š,å‰ç«¯æ— æ³•ç¯¡æ”¹

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥ (å¯é€‰ä¼˜åŒ–)

### çŸ­æœŸ
- [ ] æ·»åŠ æŠ½å¥–åŽ†å²è®°å½•é¡µé¢
- [ ] ä¼˜åŒ–è½¬ç›˜åŠ¨ç”»æ€§èƒ½
- [ ] æ·»åŠ éŸ³æ•ˆ (æ—‹è½¬éŸ³ã€ä¸­å¥–éŸ³)
- [ ] ç§»åŠ¨ç«¯æ‰‹åŠ¿æ”¯æŒ (æ»‘åŠ¨è½¬ç›˜)

### ä¸­æœŸ
- [ ] æŠ½å¥–æ•°æ®å¯è§†åŒ– (å›¾è¡¨)
- [ ] æŽ’è¡Œæ¦œ (æœ€å¹¸è¿ç”¨æˆ·)
- [ ] ç‰¹æ®Šæ´»åŠ¨ (åŒå€ç§¯åˆ†æ—¥)
- [ ] ä¿åº•æœºåˆ¶ (è¿žç»­Næ¬¡æœªä¸­å¤§å¥–ä¿åº•)

### é•¿æœŸ
- [ ] å¤šç§è½¬ç›˜ä¸»é¢˜
- [ ] è‡ªå®šä¹‰å¥–å“æ± 
- [ ] æŠ½å¥–åˆ†äº«åŠŸèƒ½
- [ ] æˆå°±å¾½ç« äº¤æ˜“å¸‚åœº

---

## ðŸ“ž æ”¯æŒ

è¯¦ç»†æ–‡æ¡£è¯·æŸ¥çœ‹: `lottery.md`

---

**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ç‰ˆæœ¬**: 1.0.0  
**æ—¥æœŸ**: 2026-01-29
